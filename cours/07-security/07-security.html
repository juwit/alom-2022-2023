<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">

    <title>ALOM - Security</title>

    <meta name="description" content="ALOM - Security">
    <meta name="author" content="Julien WITTOUCK <julien@codeka.io>">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="../reveal/dist/reveal.css">
    <link rel="stylesheet" href="../reveal/dist/theme/white.css" id="theme">

    <link rel="stylesheet" href="../css/miage-lille.css"/>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
          integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
</head>

<body>

<div class="reveal">

    <div class="slides">
        <section>
            <h1>ALOM</h1>
            <h2>üîí Security</h2>
        </section>

        <section>
            <h3><i class="fab fa-uber"></i> UBER</h3>
            <img src="images/Microservice-Architecture-Of-UBER.png" style="width: 50%"/>
        </section>

        <section>
            <h2>ü§î Probl√©matiques : </h2>
            <ul>
                <li>Comment s√©curiser les donn√©es ?</li>
                <li>Comment authentifier les utilisateurs ?</li>
            </ul>
        </section>

        <section>
            <h2>üéöÔ∏è Niveaux de s√©curit√©</h2>
            <ul>
                <li>Physique : Contr√¥le d'acc√®s, biom√©trie</li>
                <li>Hardware : Encryption des disques</li>
                <li>Middleware : Firewalls (blocage d'IP/Ports), VPN (r√©seaux priv√©s virtuels)</li>
                <li>Software : Authentification/Autorisation</li>
                <li>Data : Hashage / Chiffrement</li>
            </ul>
        </section>

        <section>
            <section>
                <h2>HTTPS</h2>
                <p>HTTPS fournit un tunnel de communications s√©curis√©</p>
                <p>Encryption des donn√©es via un algorithme asym√©trique</p>
                <p>Certificat validant l'identit√© du site + cl√© publique</p>
            </section>
            <section>
                <h2>HTTPS</h2>
                <img src="images/https.png"/>
            </section>
            <section>
                <h2>‚ö†Ô∏è HTTPS</h2>
                <ul>
                    <li>Chiffre les donn√©es entre le client et le serveur</li>
                    <li>Ne permet pas de valider l'identit√© de l'utilisateur</li>
                </ul>
            </section>
        </section>


        <section>
            <h2>Software Security</h2>
            <ul>
                <li>Authentication (authentification)</li>
                <li>Authorization (autorisation)</li>
            </ul>
        </section>
        <section>
            <h4>Authentication</h4>
            <p><i class="far fa-user fa-2x"></i> <i class="far fa-id-card fa-2x"></i></p>
            <p>V√©rification de l'identit√© d'un "principal" (un user, un device, un syst√®me qui veut effectuer une
                action)</p>
        </section>
        <section>
            <h4>Authorization</h4>
            <p><i class="fas fa-unlock-alt fa-2x"></i> <i class="fas fa-check fa-2x"></i></p>
            <p>D√©cider si un "principal" peut faire une action en particulier. (contr√¥le d'acc√®s)</p>
        </section>

        <section>
            <h4>Authentification en HTTP</h4>
            <p>Utilisation du header </p>
            <p><code>Authorization: &lt;type&gt; &lt;credentials&gt;</code></p>
            <p><code>Authorization: Basic QXNoOnBhc3N3b3Jk</code></p>
            <p><code>Authorization: Bearer QXNoOnBhc3N3b3Jk</code></p>
        </section>

        <section>
            <h4>Authentification en HTTP</h4>
            <p><code>Authorization: Basic QXNoOnBhc3N3b3Jk</code></p>
            <p>Les logins/mots de passe (ou tokens) transitent dans les headers</p>
            <p>C'est pour √ßa que l'on doit utiliser HTTPS !</p>
        </section>

        <section>
            <h4>En servlets</h4>
            <p>Utilisation des servlet filters</p>
            <img src="images/servlet-filters.png"/>
        </section>

        <section>
            <h4>En <img src="images/spring-by-pivotal.png" style="height: 1.5em; vertical-align: middle;"></h4>
            <h5>spring-security</h5>
            <ul>
                <li>Authentification (validation des credentials)</li>
                <li>Utilisation d'un Cookie HTTP pour identifiant de session</li>
                <li>Stockage de "principal" en session c√¥t√© serveur</li>
                <li>Logout : suppression de la session</li>
                <li>Protection contre le vol de session (CSRF & Session Fixation)</li>
                <li>Protection contre les appels venant de sources inconnues (CORS)</li>
            </ul>
        </section>

        <section data-markdown>
            <textarea data-template>
                #### spring-security

                ```xml
                <dependency>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-starter-security</artifactId>
                </dependency>
                ```


                Le simple fait d'ajouter spring security au classpath s√©curise toutes les routes d'une application et
                ajoute une page de login par d√©faut.

                ---

                #### spring-security

                La classe `WebSecurityConfigurerAdapter` permet de configurer les r√®gles de s√©curit√©:

                * routes √† prot√©ger
                * √©cran de login

                ```java
@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

}
                ```

                ---

                #### spring-security

                ```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .authorizeRequests()
            .antMatchers("/", "/icons/**", "/images/**").permitAll()
            .anyRequest().authenticated()
        .and()
        .formLogin()
            .loginPage("/login")
            .permitAll()
        .and()
        .logout()
            .permitAll();
}
                ```

                ---

                #### spring-security

                R√©cup√©ration des utilisateurs via un `UserDetailsService`.
                Par d√©faut, un `UserDetailsService` *in-memory* est cr√©√© √† partir des properties:
                * `spring.security.user.name`
                * `spring.security.user.password`
                * `spring.security.user.roles`

                ---
                #### spring-security

                Configuration d'un `UserDetailsService` avec un Bean Spring.
                Un `UserDetailsService` doit retourner des `UserDetails`.

                ```java
@Autowired
private TrainerService trainerService;

@Bean
@Override
public UserDetailsService userDetailsService() {
    return username -> Optional.ofNullable(trainerService.getTrainer(username))
            .orElseThrow(() -> new BadCredentialsException("No such user"));
}
                ```
            </textarea>
        </section>

        <section>
            <h4>spring-security</h4>
            <p>Page de login</p>
            <img src="carbon/login.png"/>
        </section>

        <section data-markdown>
            <textarea data-template>
                #### spring-security
                Acc√®s √† l'utilisateur loggu√©.

                Injection du `Principal`

                ```java
                @GetMapping("/otherTrainers")
                public Iterable<Trainers> getOtherTrainers(Principal principal) {
                    return trainerRepository.findOtherTrainers(principal.getName());
                }
                ```

                `SecurityContextHolder`

                ```java
                @GetMapping("/otherTrainers")
                public Iterable<Trainers> getOtherTrainers() {
                    var auth = SecurityContextHolder.getContext().getAuthentication();
                    var principal = (Principal) auth.getPrincipal();
                    return trainerRepository.findOtherTrainers(principal.getName());
                }
                ```
            </textarea>
        </section>

        <section>
            <h4>spring-security</h4>
            <p>S√©curisation des services REST par d√©faut</p>
            <ul>
                <li>Username : <code>user</code></li>
                <li>Password : loggu√© sur la console</li>
            </ul>
            <code>Using generated security password: 112eb169-1567-42fe-bf0e-7c7bc94a5afa</code>
        </section>

        <section>
            <h4>spring-security</h4>
            <p>Personalisation de la s√©curisation des services REST</p>
            <ul>
                <li>Username : <code>spring.security.user.name</code></li>
                <li>Password : <code>spring.security.user.password</code></li>
            </ul>
        </section>

        <section data-markdown>
            <textarea data-template>
                #### spring-security

                S√©curisation des m√©thodes par annotations sur les m√©thodes de Controlleur.

                ```java
                @Secured("ROLE_VIEWER")
                ```
                ```java
                @Secured("ROLE_ADMIN")
                ```

                Configuration
                ```java
                @Configuration
                @EnableGlobalMethodSecurity(securedEnabled = true)
                public class MethodSecurityConfig extends GlobalMethodSecurityConfiguration {
                }
                ```
            </textarea>
        </section>

        <section data-markdown>
            <textarea data-template>
                #### Recommandation g√©n√©rales
                *Kids, don't do this at home*

                * Ne stockez **JAMAIS** de mot de passe en clair
                * Ne faites **JAMAIS** de concat√©nation de cha√Ænes pour g√©n√©rer des requ√™tes SQL
                * √âvitez de stocker des *secrets* dans des properties (utilisez des variables d'environnement)
                * Utilisez du HTTPS et du TLS d√®s que possible
                * S√©curisez vos routes HTTP
                * Chiffrez les donn√©es en base si les donn√©es sont sensibles
            </textarea>
        </section>

        <section>
            <h2>TP</h2>
            <img src="../images/leonidas.png"/>
            <p>
                <a href="./07-tp-security.html">Security üîí</a>
            </p>
        </section>

    </div>

</div>

<script src="../reveal/dist/reveal.js"></script>
<script src="../reveal/plugin/markdown/markdown.js"></script>
<link rel="stylesheet" href="../reveal/plugin/highlight/zenburn.css">
<script src="../reveal/plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight],
        markdown: {
            smartypants: true
        }
    });
</script>

<aside class="miage_aside_logo"></aside>

</body>
</html>
