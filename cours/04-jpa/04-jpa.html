<!doctype html>
<html lang="fr">

	<head>
		<meta charset="utf-8">

		<title>ALOM - JPA</title>

		<meta name="description" content="ALOM - Persistance de donn√©es avec JPA">
		<meta name="author" content="Julien WITTOUCK <julien@codeka.io>">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="../reveal/dist/reveal.css">
        <link rel="stylesheet" href="../reveal/dist/theme/white.css" id="theme">

        <link rel="stylesheet" href="../css/miage-lille.css"/>

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

	</head>

	<body>

		<div class="reveal">

			<div class="slides">
				<section>
					<h2>ALOM</h2>
					<h3>üîñ Persistance de donn√©es avec JPA</h3>
				</section>

				<section>
                    <h3><i class="fab fa-uber"></i> UBER</h3>
					<img src="images/Microservice-Architecture-Of-UBER.png" style="width: 50%"/>
				</section>

				<section>
					<h3><img src="images/micro-service-poke.png" style="vertical-align: middle;"/> Un micro-service c'est :</h3>
					<ul>
                        <li>Un ensemble de fonctionnalit√©s du m√™me domaine m√©tier</li>
                        <li>
							Un ou plusieurs canaux de communication
							<ul>
								<li>HTTP - REST/JSON</li>
							</ul>
						</li>
						<li>Une source de donn√©es d√©di√©e</li>
					</ul>
				</section>

				<section>
					<h3>üîé un micro-service Java</h3>
					<p>On s'appuie sur les technologies connues: les servlets !</p>
					<img src="images/architecture.svg"/>
				</section>

                <section>
                    <h3>üîé La source de donn√©es</h3>
                    <p>Une application :</p>
                    <ul>
                        <li>fournit un service</li>
                        <li>manipule des donn√©es</li>
                    </ul>
                    <p>Probl√©matique :</p>
                    <ul>
                        <li>comment enregistrer des donn√©es?</li>
                        <li>comment acc√©der aux donn√©es enregistr√©es?</li>
                    </ul>
                </section>

                <section>
                    <h3>Design Best Practices</h3>
                    <h3>üëÆ S.O.L.I.D</h3>
                </section>
                <section>
                    <h3>Design Pattern</h3>
                    <h3>üíâ Injection de d√©pendance</h3>
                </section>
                <section>
                    <h3>Design Pattern</h3>
                    <h3>DAO - Data Access Object</h3>
                    <img src="images/dao-pattern.png"/>
                </section>

                <section>
                    <h3>üîé La source de donn√©es</h3>
                    <uL>
                        <li class="fragment">des fichiers</li>
                        <li class="fragment">une API</li>
                        <li class="fragment">une base de donn√©es SQL</li>
                        <li class="fragment">une base de donn√©es NoSQL</li>
                    </uL>
                </section>

                <section>
                    <h3>Bases de donn√©es SQL</h3>
                    <p>Mod√®le relationnel (SQL)</p>
                    <ul>
                        <li>Stockage de l'information en tables</li>
                        <li>Relations entre les tables (cl√©s √©trang√®res)</li>
                        <li>Requ√™tage dans un langage d√©di√© : SQL</li>
                    </ul>
                </section>

                <section>
                    <h3>Bases de donn√©es SQL</h3>
                    <p>Comment lier le mod√®le BDD relationnel et le mod√®le objet Java?</p>
                    <div style="width: 100%;">
                        <div style="float: left;">
                            <img src="images/ash-vs-misty.png">
                        </div>
                        <div style="font-size: large; float: right;">
                            <table style="border: solid 2pt #095A80;">
                                <thead style="background-color: #095A80; color: white;">
                                <tr><td>id</td><td>name</td><td>sprite</td></tr>
                                </thead>
                                <tbody style="border: solid 2pt #095A80">
                                <tr style="border: solid 2pt #095A80"><td>25</td><td>pikachu</td><td>pikachu.png</td></tr>
                                <tr style="border: solid 2pt #095A80"><td>120</td><td>staryu</td><td>staryu.png</td></tr>
                                <tr style="border: solid 2pt #095A80"><td>121</td><td>starmie</td><td>starmie.png</td></tr>
                                </tbody>
                            </table>
                            <br/>
                            <table style="border: solid 2pt #095A80;">
                                <thead style="background-color: #095A80; color: white;">
                                <tr><td>id</td><td>name</td></tr>
                                </thead>
                                <tbody style="border: solid 2pt #095A80">
                                <tr style="border: solid 2pt #095A80"><td>1</td><td>ash</td></tr>
                                <tr style="border: solid 2pt #095A80"><td>2</td><td>misty</td></tr>
                                </tbody>
                            </table>
                            <br/>
                            <table style="border: solid 2pt #095A80;">
                                <thead style="background-color: #095A80; color: white;">
                                <tr><td>trainer_id</td><td>pokemon_type</td><td>level</td></tr>
                                </thead>
                                <tbody style="border: solid 2pt #095A80">
                                <tr style="border: solid 2pt #095A80"><td>1</td><td>25</td><td>18</td></tr>
                                <tr style="border: solid 2pt #095A80"><td>2</td><td>120</td><td>18</td></tr>
                                <tr style="border: solid 2pt #095A80"><td>2</td><td>121</td><td>21</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section>
                    <h3>√† la dure : JDBC</h3>
                    <img src="carbon/jdbc.png"/>
                </section>

                <section>
                    <h3>Fonctionnement de JDBC</h3>
                    <img src="images/jdbc-architecture.png"/>
                </section>

                <section>
                    <section>
                        <h4>JDBC avec <img src="images/spring-by-pivotal.png" style="height: 1.5em; vertical-align: middle;"> : <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#jdbc-JdbcTemplate">JDBCTemplate</a></h4>
                        <img src="carbon/jdbcTemplate.png"/>
                    </section>
                    <section data-markdown>
                        <textarea data-template>
                            #### Configuration spring-boot
                            ```xml
                            <dependency>
                                <groupId>org.springframework.boot</groupId>
                                <artifactId>spring-boot-starter-jdbc</artifactId>
                            </dependency>
                            ```
                            \+ un driver JDBC

                            ```xml
                            <dependency>
                                <groupId>org.postgresql</groupId>
                                <artifactId>postgresql</artifactId>
                                <scope>runtime</scope>
                            </dependency>
                            ```

                            ![](images/spring-boot-starter-jdbc.png)

                            ---

                            ```xml [4]
                            <dependency>
                                <groupId>org.postgresql</groupId>
                                <artifactId>postgresql</artifactId>
                                <scope>runtime</scope>
                            </dependency>
                            ```

                            Les drivers JDBC peuvent √™tre positionn√©s en *scope* Maven `runtime`.

                            * Ils ne sont pas n√©cessaire √† la compilation du code
                            * Leur *jar* doit √™tre pr√©sent √† l'ex√©cution

                            ---

                            #### üîé JDBC AutoConfiguration
                            ![](images/spring-boot-jdbc-autoconfiguration.png)

                            ---

                            ##### DataSourceProperties
                            Permet de configurer la source de donn√©es
                            ```properties
                            spring.datasource.url
                            spring.datasource.username
                            spring.datasource.password
                            ```

                            ##### DataSourceAutoConfiguration
                            Configure un *bean* de type `javax.sql.DataSource`.

                            Si `spring.datasource.url` est renseign√©e, elle sera utilis√©e.
                            Sinon, si une base de donn√©es embarqu√©e (*h2*, *derby*, ou *hsqldb*) est disponible, elle sera utilis√©e.

                            Utilise une impl√©mentation avec un pool de connexions si disponible (HikariCP par d√©faut).

                            ---

                            ##### Cas d'usages
                            Utilisation de la base de donn√©es embarqu√©e H2:
                            ```xml
                            <dependency>
                                <groupId>com.h2database</groupId>
                                <artifactId>h2</artifactId>
                                <scope>runtime</scope>
                            </dependency>
                            ```
                            Pas de properties particuli√®res.

                            ---

                            ##### Cas d'usages
                            Utilisation d'une base de donn√©es postgresql:
                            ```xml
                            <dependency>
                                <groupId>org.postgresql</groupId>
                                <artifactId>postgresql</artifactId>
                                <scope>runtime</scope>
                            </dependency>
                            ```

                            Properties avec l'url:

                            ```properties
                            spring.datasource.url=jdbc:postgresql://<database_host>:<port>/<database_name>
                            spring.datasource.username=<user>
                            spring.datasource.password=<password>
                            ```

                        </textarea>
                    </section>
                    <section data-markdown>
                        <textarea data-template>
                            ##### JdbcTemplateConfiguration
                            Si un *bean* de type `javax.sql.DataSource` existe, cr√©e un bean de type `org.springframework.jdbc.core.JdbcTemplate`.
                            ```java [1,6|2,3,6|5,6,10|10-25]
@AutoConfiguration(after = DataSourceAutoConfiguration.class)
@ConditionalOnClass({ DataSource.class, JdbcTemplate.class })
@ConditionalOnSingleCandidate(DataSource.class)
@EnableConfigurationProperties(JdbcProperties.class)
@Import({ JdbcTemplateConfiguration.class})
public class JdbcTemplateAutoConfiguration {}

@Configuration
@ConditionalOnMissingBean(JdbcTemplate.class)
class JdbcTemplateConfiguration {

	@Bean
	@Primary
	JdbcTemplate jdbcTemplate(DataSource dataSource, JdbcProperties properties) {
		JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);
		JdbcProperties.Template template = properties.getTemplate();
		jdbcTemplate.setFetchSize(template.getFetchSize());
		jdbcTemplate.setMaxRows(template.getMaxRows());
		if (template.getQueryTimeout() != null) {
			jdbcTemplate.setQueryTimeout((int) template.getQueryTimeout().getSeconds());
		}
		return jdbcTemplate;
	}

}
                            ```
                        </textarea>
                    </section>
                </section>

                <section class="stack">
                    <section>
                        <h3>JPA - Java Persistence API</h3>
                        <p>Surcouche √† JDBC - Fournit un moyen de mapper les tables aux objets et une abstraction de l'ex√©cution de requ√™tes via les <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/package-summary.html">annotations</a></p>
                        <img src="carbon/trainer.png" style="width: 40%;"/>
                    </section>
                    <section>
                        <h3>Fonctionnement de JPA</h3>
                        <img src="images/04-jpa.png"/>
                    </section>
                    <section>
                        <h4>JPA avec <img src="images/spring-by-pivotal.png" style="height: 1.5em; vertical-align: middle;"> </h4>
                        <p>Repository Spring/JPA (<a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/dao.html">mode DAO</a>):</p>
                        <img src="carbon/jpa.png" style="width: 70%;"/>
                    </section>
                    <section>
                        <h3><img src="images/spring-by-pivotal.png" style="height: 1.5em; vertical-align: middle;"> <a href="http://docs.spring.io/spring-data/jpa/docs/current/reference/html/">spring-data JPA</a></h3>
                        <p>G√©n√©ration automatique des m√©thodes au runtime √† partir d'interfaces!</p>
                        <img src="carbon/spring-data-jpa.png"/>
                    </section>

                    <section data-markdown>
                        <textarea data-template>
                            ### [spring-data JPA](http://docs.spring.io/spring-data/jpa/docs/current/reference/html/")
                            Configuration Maven
                            ```xml
<!-- spring-data JPA -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
<!-- an embedded database -->
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>
                            ```
                        </textarea>
                    </section>
                </section>

                <section>
                    <h3>TP</h3>
                    <img src="../images/leonidas.png"/>
                    <p>
                        <a href="04-tp-jpa.html">JPA & Spring repositories !</a>
                    </p>
                </section>

                <section style="text-align:left;">
                <h1>Fin du cours</h1>
                </section>

			</div>

		</div>

        <script src="../reveal/dist/reveal.js"></script>
        <script src="../reveal/plugin/markdown/markdown.js"></script>
        <link rel="stylesheet" href="../reveal/plugin/highlight/zenburn.css">
        <script src="../reveal/plugin/highlight/highlight.js"></script>
        <script>
            // More info about initialization & config:
            // - https://revealjs.com/initialization/
            // - https://revealjs.com/config/
            Reveal.initialize({
                hash: true,

                // Learn about plugins: https://revealjs.com/plugins/
                plugins: [ RevealMarkdown, RevealHighlight ]
            });
        </script>

        <aside class="miage_aside_logo"></aside>

    </body>
</html>
