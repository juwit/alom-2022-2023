<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">

    <title>ALOM - Cloud</title>

    <meta name="description" content="ALOM - High Availability">
    <meta name="author" content="Julien WITTOUCK <julien@codeka.io>">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="../reveal/dist/reveal.css">
    <link rel="stylesheet" href="../reveal/dist/theme/white.css" id="theme">

    <link rel="stylesheet" href="../css/miage-lille.css"/>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
          integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
</head>

<body>

<div class="reveal">

    <div class="slides">
        <section>
            <h1>ALOM</h1>
            <h2><i class="em em-cloud"></i> Patterns orient√©s cloud</h2>
        </section>

        <section>
            <h3><i class="fab fa-uber"></i> UBER</h3>
            <img src="images/Microservice-Architecture-Of-UBER.png" style="width: 50%"/>
        </section>

        <section>
            <h2>Probl√©matiques : </h2>
            <p>Comment d√©ployer les services ?</p>
            <p>Comment g√©rer la configuration des services ?</p>
            <p>Comment analyser l'encha√Ænement des appels ?</p>
            <p>Comment conna√Ætre l'√©tat de l'application ?</p>
        </section>

        <!-- cloud -->
        <section>
            <h2>Cloud "as a service"</h2>
            <ul>
                <li>IaaS : Infrastructure as a Service</li>
                <li>PaaS : Platform as a Service</li>
                <li>SaaS : Software as a Service</li>
            </ul>
            <img src="images/iaas--paas-saas-diagram.png">
        </section>
        <section>
            <h2>Cloud üá´üá∑</h2>
            <ul>
                <li>
                    IaaS : VM, Disks, Load-Balancers
                    <ul>
                        <li>OVH Cloud</li>
                        <li>Scaleway</li>
                        <li>nua.ge</li>
                        <li>hopla.cloud</li>
                        <li>Outscale</li>
                    </ul>
                </li>
                <li>
                    PaaS : Database, Middleware, Object Storage, Runtime Java / Container, Functions
                    <ul>
                        <li>OVH : Databases & k8s, Object Storage</li>
                        <li>Scaleway: Databases & k8s, Object Storage, Serverless Functions</li>
                        <li>Clever-Cloud: PaaS, Databases, Object Storage</li>
                        <li>Scalingo: PaaS, Databases</li>
                    </ul>
                </li>
            </ul>
        </section>
        <section>
            <h2>Cloud üá∫üá≤</h2>
            <ul>
                <li>
                    IaaS : VM, Disks, Load-Balancers
                    <ul>
                        <li>AWS EC2</li>
                        <li>GCP GCE</li>
                        <li>Azure VM</li>
                    </ul>
                </li>
                <li>
                    PaaS : Database, Middleware, Object Storage, Runtime Java / Container, Functions
                    <ul>
                        <li>AWS : RDS Databases, EKS, S3 Object Storage, AWS Lambdas</li>
                        <li>GCP Cloud SQL, GKE, GCS Object Storage, Cloud Functions, App Engine, Pub/Sub</li>
                        <li>Azure SQL Database, AKS, Azure Blob Storage, Azure Functions</li>
                    </ul>
                </li>
            </ul>
        </section>
        <section>
            <h2>Une architecture Cloud</h2>
            <p>Une application Java dans un assemblage de services Cloud</p>
            <img src="images/second-hand.png"/>
        </section>
        <section>
            <h2>Une architecture Cloud</h2>
            <ul>
                <li>DNS (Route53)</li>
                <li>Load Balancers (ALB)</li>
                <li>VM (EC2) ‚¨ÖÔ∏è notre code est ici</li>
                <li>Base de donn√©es manag√©e (PostgreSQL)</li>
                <li>Cache manag√© (ElasticSearch)</li>
                <li>CDN (CloudFront)</li>
                <li>Stockage objet (S3)</li>
                <li>Messaging (SQS)</li>
                <li>Mailing (SES)</li>
            </ul>
        </section>

        <!-- configuration -->
        <section>
            <h3>Patterns d'architecture</h3>
            <h4>Configuration externalis√©e</h4>
        </section>
        <section>
            <h4>Configuration externalis√©e</h4>
            <p>Permet d'ex√©cuter un service dans multiples environnements sans modifications</p>
            <ul>
                <li>Acc√®s BDD</li>
                <li>Gestion s√©curit√©</li>
                <li>etc...</li>
            </ul>
            <p>Plusieurs strat√©gies</p>
            <ul>
                <li>Profiles : un fichier de configuration par profil</li>
                <li>Variables d'environnement</li>
            </ul>
        </section>
        <section>
            <h4>Configuration externalis√©e</h4>
            <p>Profils</p>
            <ul>
                <li>Activation par la properties <code>spring.profiles.active</code></li>
                <li>ou variable d'environnement <code>SPRING_PROFILES_ACTIVE</code></li>
            </ul>
            <p>Permet de charger un fichier <code>application-{profile}.properties</code> en plus du <code>application.properties</code>.
            </p>
            <p>Exemples: <code>application-local.properties</code> et <code>application-prod.properties</code> contenant
                des ports/connexions BDD diff√©rentes.</p>
        </section>
        <section>
            <h4>Configuration externalis√©e chez Spring</h4>
            <p>Variables d'environnement</p>
            <p>Toutes les properties Spring peuvent √™tre surcharg√©es par des variables d'environnement</p>
            <ul>
                <li>Les <code>.</code> sont remplac√©s par des <code>_</code>.</li>
                <li>Tout est mis en majuscule</li>
                <li>Le camel-case est convertit en <code>_</code></li>
            </ul>
        </section>
        <section>
            <h4>Configuration externalis√©e chez Spring</h4>
            <p>Variables d'environnement</p>
            <p>Exemples: </p>
            <ul>
                <li><code>server.port=8080</code> ‚û°Ô∏è <code>SERVER_PORT=8080</code></li>
                <li><code>trainer.service.username=vegeta</code> ‚û°Ô∏è <code>TRAINER_SERVICE_USERNAME=vegeta</code></li>
                <li><code>trainer.serviceUrl=https://someurl:8080</code> ‚û°Ô∏è <code>TRAINER_SERVICE_URL=https://someurl:8080</code>
                </li>
            </ul>

        </section>

        <section>
            <h4>Configuration externalis√©e chez Spring</h4>
            <p>Interpolation de properties</p>
            <p>Il est possible dans des properties d'en utiliser d'autres</p>
            <ul>
                <li><code>trainer.service.host=someHost</code></li>
                <li><code>trainer.service.port=8080</code></li>
                <li><code>trainer.service.url=
                    https://${trainer.service.host}:${trainer.service.port}</code></li>
            </ul>

        </section>

        <!-- centralisation de logs -->
        <section>
            <h3>Patterns d'architecture</h3>
            <h4>Centralisation des logs et correlation</h4>
        </section>
        <section>
            <h4>Centralisation des logs</h4>
            <p>Dans un environnement load-balanc√©, les requ√™tes d'un utilisateur peuvent √™tre trait√©es par n'importe
                quel serveur.</p>
            <p>Dans un environnement cloud, on ne peut pas forc√©ment acc√©der aux machines pour consulter les fichiers de
                log.</p>
            <p>Dans un environnement conteneuris√©, on ne peut pas forc√©ment acc√©der aux logs des containers
                (kubernetes...)</p>
        </section>
        <section>
            <h4>Centralisation des logs</h4>
            <p>On envoie tous les logs dans un service d√©di√©</p>
            <ul>
                <li>un service lit les fichiers de log et envoie les lignes au serveur</li>
                <li>les logs sont index√©s et conserv√©s</li>
                <li>une IHM permet de les consulter</li>
            </ul>
        </section>
        <section>
            <h4>Centralisation des logs</h4>
            <img src="images/elk.png"/>
        </section>
        <section>
            <h4>Centralisation des logs</h4>
            <p>Produit connus :</p>
            <p>Stack "ELK"</p>
            <ul>
                <li>Elasticsearch : indexation des logs, et recherche "full-text"</li>
                <li>Logstash : Parsing des fichiers de logs, et envoi √† Elasticsearch</li>
                <li>Kibana : IHM de consultation d'Elasticsearch : recherche, dashboards...</li>
            </ul>
        </section>
        <section>
            <h4>Correlation des logs</h4>
            <p>Observer la s√©quencialit√© des appels</p>
            <p>Observer les logs d'un m√™me utilisateur</p>
            <p>Trouver des points de contention</p>
            <p>Aide au debugging</p>
        </section>
        <section>
            <h4>Correlation des logs</h4>
            <p>Correlation des appels via des Headers HTTP</p>
            <p>Cr√©ation d'un id pour chaque requ√™te re√ßue</p>
            <p>Transmission de l'id √† chaque requ√™te envoy√©e</p>
            <p>Envoi des traces √† un outil centralis√©</p>
        </section>
        <section>
            <h4>Correlation des logs</h4>
            <p><a href="https://spring.io/projects/spring-cloud-sleuth">Spring Cloud Sleuth</a> permet de g√©rer ces
                correllation (il modifie les RestTemplate pour transmettre ces fameux headers).</p>
            <p><a href="https://zipkin.io/">Zipkin</a> permet de collecter/consulter ce type d'information</p>
        </section>
        <section>
            <h4>Correlation des logs</h4>
            <img src="images/zipkin.png"/>
        </section>

        <!-- m√©triques -->
        <section>
            <h3>Patterns d'architecture</h3>
            <h4>M√©triques</h4>
        </section>
        <section>
            <h4>M√©triques</h4>
            <p>Observer la sant√© des services</p>
            <ul>
                <li>healthcheck : est-ce que le service r√©pond, est-ce que la BDD est bien connect√©e</li>
                <li>trace : r√©cup√©rer les derni√®res requ√™tes HTTP trait√©es</li>
                <li>metrics : consommations m√©moire / CPU</li>
            </ul>
            <p>M√©triques m√©tier (~analytics)</p>
            <ul>
                <li>Combien d'inscriptions au site</li>
                <li>Combien de commandes pass√©es</li>
                <li>...</li>
            </ul>
        </section>
        <section>
            <h4>M√©triques</h4>
            <p>Exposition des m√©triques dans une application spring-boot</p>
            <p>Utilisation de <a
                    href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html">spring-boot-actuator</a>
            </p>
            <p>Expose des m√©triques basiques de nos applications/api</p>
        </section>
        <section>
            <h4>M√©triques</h4>
            <h5>Collecte des m√©triques et exploitation</h5>
            <p>Comme pour les logs, les m√©triques peuvent √™tre envoy√©es √† un serveur d√©di√© pour √™tre consult√©es</p>
            <p>Centralisation des m√©triques</p>
        </section>
        <section>
            <h4>M√©triques</h4>
            <p>M√™me principe que pour les logs</p>
            <img src="images/prometheus.png"/>
        </section>
        <section>
            <h4>M√©triques</h4>
            <p>Produit connus :</p>
            <p>Stack "Prometheus/Grafana"</p>
            <ul>
                <li>Prometheus : Concentration des m√©triques (BDD time/series)</li>
                <li>Grafana : Affichage sous forme de graphes, altering</li>
            </ul>
        </section>
        <section>
            <h4>M√©triques</h4>
            <p>Agir en fonction des m√©triques</p>
            <p>Pris en charge par les orchestrateurs de containers (kubernetes par exemple)</p>
            <ul>
                <li>healthcheck KO => red√©marrer le service</li>
                <li>consommation m√©moire / CPU √©lev√©e => d√©ployer une instance suppl√©mentaire du service (scale up)</li>
            </ul>
        </section>


        <section>
            <h2>TP</h2>
            <img src="../images/leonidas.png"/>
            <p>
                <a href="09-tp-cloud.html">Patterns cloud <i class="em em-cloud"></i></a>
            </p>
        </section>

    </div>

</div>

<script src="../reveal/dist/reveal.js"></script>
<script src="../reveal/plugin/markdown/markdown.js"></script>
<link rel="stylesheet" href="../reveal/plugin/highlight/zenburn.css">
<script src="../reveal/plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight],
        markdown: {
            smartypants: true
        }
    });
</script>

<aside class="miage_aside_logo"></aside>

</body>
</html>
