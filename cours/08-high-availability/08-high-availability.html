<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">

    <title>ALOM - High Availability</title>

    <meta name="description" content="ALOM - High Availability">
    <meta name="author" content="Julien WITTOUCK <julien@codeka.io>">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="../reveal/dist/reveal.css">
    <link rel="stylesheet" href="../reveal/dist/theme/white.css" id="theme">

    <link rel="stylesheet" href="../css/miage-lille.css"/>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
          integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
</head>

<body>

<div class="reveal">

    <div class="slides">
        <section>
            <h1>ALOM</h1>
            <h2>ü¶Ñ High Availability & Micro-Services patterns</h2>
        </section>

        <section>
            <h3><i class="fab fa-uber"></i> UBER</h3>
            <img src="images/Microservice-Architecture-Of-UBER.png" style="width: 50%"/>
        </section>

        <section>
            <h2>Probl√©matiques : </h2>
            <p>Comment absorber la charge ?</p>
            <p>Que faire si un micro-service ne r√©pond pas ?</p>
            <p>Comment limiter la charge ?</p>
        </section>

        <section>
            <h2>üí° Trouver le point de rupture d'un micro-service</h2>
            <p>Faire un test de charge</p>
            <ul>
                <li>JMeter</li>
                <li>Gatling</li>
            </ul>
        </section>

        <section>
            <h3>Patterns d'architecture</h3>
            <h4>Load-Balancing</h4>
            <p>R√©partition de charge sur plusieurs serveurs</p>
            <img src="images/load-balancer.png"/>
        </section>

        <section>
            <h4>Load-Balancing</h4>
            <p>Plusieurs techniques :</p>
            <ul>
                <li>DNS load-balancing</li>
                <li>Reverse-proxy load-balancing</li>
                <li>Client-side load-balancing</li>
            </ul>
            <p>Plusieurs strat√©gies</p>
            <ul>
                <li>round-robin</li>
                <li>least-connection</li>
                <li>ip-hash</li>
                <li>cookie</li>
            </ul>
        </section>

        <section>
            <h4>DNS load-balancing (round-robin)</h4>
            <img src="carbon/dns.png" style="width: 50%;"/>
            <p>Le serveur DNS r√©pondra s√©quentiellement chaque adresse IP</p>
            <p>‚ö†Ô∏è Les services doivent √™tre "stateless" !</p>
        </section>

        <section>
            <h4>reverse-proxy load-balancing</h4>
            <p>un serveur interm√©diaire qui fait le travail (Apache httpd, HAProxy, Nginx...)</p>
            <img src="carbon/nginx.png" style="width: 50%;"/>
        </section>

        <section>
            <h4>reverse-proxy load-balancing</h4>
            <p>‚ÑπÔ∏è Les services peuvent √™tre "statefull" en <code>ip-hash</code>!</p>
            <img src="carbon/nginx.png" style="width: 50%;"/>
        </section>

        <section>
            <h4>client-side load-balancing</h4>
            <img src="images/client-side.png" style="width: 50%;"/>
        </section>

        <section>
            <h4>client-side load-balancing</h4>
            <p>Le client (micro-service java) r√©cup√®re la liste de toutes les adresses d'un service</p>
            <p>Il se charge de r√©partir les appels</p>
            <p>N√©cessite un <code>service-registry</code></p>
        </section>

        <section>
            <h4>Cache</h4>
            <p>Mettre en cache des objets :</p>
            <ul>
                <li>Am√©liore les temps de r√©ponse</li>
                <li>Limite les appels aux syst√®mes sous-jacents</li>
            </ul>
            <p>‚ö†Ô∏è La mise en cache est facile. Supprimer des objets en cache est √† r√©fl√©chir!</p>
        </section>

        <section>
            <h4>Cache</h4>
            <p>Types de cache</p>
            <ul>
                <li>Local : en m√©moire ou sur le disque (une Map !, EhCache, ...)</li>
                <li>Distribu√© : un service d√©di√© (Redis, Hazelcast, ...)</li>
            </ul>
            <p>Le cache local est toujours plus performant, le cache distribu√© est partag√© entre toutes les instances
                d'un service, mais n√©cessite un appel r√©seau !</p>
        </section>

        <section>
            <h4>‚ÑπÔ∏è Cache distribu√©</h4>
            <p>Un cache distribu√© peut permettre de g√©rer une session utilisateur dans un syst√®me stateless !</p>
            <p>La session est stock√© en cache, et non plus en m√©moire, elle peut √™tre disponible sur l'ensemble des
                instances de notre application !</p>
        </section>

        <section>
            <h4>Supprimer des objets du cache</h4>
            <p>Le cache est pratique pour les donn√©es "r√©f√©rentielles"</p>
            <p>Pour les donn√©es "vivantes", pr√©voir une √©viction du cache quand l'objet est modifi√©</p>
            <p>Notion d'expiration ou <code>TTL</code>
            </p>
        </section>

        <section>
            <h2>Cache Vs The cost of I/O : </h2>
            <table>
                <thead>
                <th>Action</th>
                <th>Latency</th>
                <th># of cycles</th>
                <th>Human Time</th>
                </thead>
                <tbody>
                <tr>
                    <td>1 Cycle CPU (3GHz Clock)</td>
                    <td>0.3 ns</td>
                    <td>1</td>
                    <td>1 s</td>
                </tr>
                <tr>
                    <td>RAM access</td>
                    <td>70 - 100 ns</td>
                    <td>233 - 333</td>
                    <td>3.5 - 5.5 m</td>
                </tr>
                <tr>
                    <td>NVMe SSD</td>
                    <td>7 - 150 ¬µs</td>
                    <td>23k - 500k</td>
                    <td>6.5 h - 5.5 d</td>
                </tr>
                <tr>
                    <td>Internet: SF to NYC</td>
                    <td>40 ms</td>
                    <td>130 M</td>
                    <td>4.2 years</td>
                </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>R√©silience</h2>
            <p>Capacit√© d'un syst√®me √† surmonter une alt√©ration de son environnement</p>
        </section>

        <section>
            <h4>En micro-services</h4>
            <p>Que faire si le micro-service auquel j'ai envoy√© une requ√™te n'est pas disponible ?</p>
            <ul>
                <li>500 Internal Server Error</li>
                <li>java.io.IOException: Connection reset by peer</li>
                <li>java.net.ConnectException: Connection refused</li>
            </ul>
            <p>üîÉ Retry !</p>
        </section>

        <section>
            <p>üîÉ Retry !</p>
            <p>Avec un peu de chance, le micro-service sera dispo quelques milli-secondes apr√®s cette erreur.</p>
            <p>Si le micro-service est derri√®re un load-balancer, le load-balancer va d√©sactiver le routage vers
                l'instance en erreur.</p>
            <p>Permet de compenser des erreurs temporaires</p>
        </section>

        <section>
            <h4>java.io.IOException: Connection timed out</h4>
            <p>Notre service a pass√© du temps √† attendre une r√©ponse qu'il n'a pas eu.</p>
            <p>Il est probable que les appels suivants auront le m√™me probl√®me</p>
        </section>

        <section>
            <h4>Circuit-Breaker</h4>
            <p>On "ouvre" le circuit si on a rencontr√© plusieurs erreurs/timeout</p>
            <p><code>fail-fast</code></p>
            <p>On peut fournir un mode-d√©grad√©</p>
            <p>On refermera le circuit petit √† petit si tout se passe bien</p>
        </section>

        <section>
            <h4>Circuit-Breaker</h4>
            <img src="images/circuit-breaker.png" style="width: 50%;"/>
        </section>

        <section>
            <h4>Impl√©mentations avec Spring / Spring-boot</h4>
            <ul>
                <li>Cache</li>
                <li>Retry</li>
            </ul>
        </section>

        <section>
            <h4>Cache <small>(spring-boot-starter-cache)</small></h4>
            <ul>
                <li><code>@EnableCaching</code> active la gestion du cache (cr√©ation d'un <code>CacheManager</code>)
                </li>
                <li><code>@Cacheable("&lt;cache-name&gt;")</code> active le cache sur une m√©thode</li>
            </ul>
            <p>Si pas de librairie de cache dans le classpath, Spring utilisera une <code>ConcurrentHashMap</code></p>
            <p>Librairies (Cache providers): EhCache, Redis</p>
            <p>Il est possible de recevoir le <code>CacheManager</code> en injection de d√©pendances pour manipuler
                directement le cache</p>
        </section>

        <section>
            <h4>@EnableCaching</h4>
            <img src="carbon/CacheConfiguration.png"/>
        </section>

        <section>
            <h4>@Cacheable</h4>
            <img src="carbon/Cacheable.png"/>
        </section>

        <section>
            <h4>Retry <small>spring-retry</small></h4>
            <ul>
                <li><code>@EnableRetry</code> active la gestion du retry</li>
                <li><code>@Retryable</code> active le retry sur une m√©thode √† chaque exception ! (3 tentatives par
                    d√©faut)
                </li>
            </ul>
        </section>

        <section>
            <h4>spring-retry</h4>
            <img src="carbon/spring-retry.png"/>
        </section>

        <section>
            <h4>@EnableRetry</h4>
            <img src="carbon/RetryConfiguration.png"/>
        </section>

        <section>
            <h4>@Retryable</h4>
            <img src="carbon/Retryable.png"/>
        </section>

        <section>
            <h2>TP</h2>
            <img src="../images/leonidas.png"/>
            <p>
                <a href="./08-tp-high-availability.html">High-Availability ü¶Ñ</a>
            </p>
        </section>

    </div>

</div>

<script src="../reveal/dist/reveal.js"></script>
<script src="../reveal/plugin/markdown/markdown.js"></script>
<link rel="stylesheet" href="../reveal/plugin/highlight/zenburn.css">
<script src="../reveal/plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight],
        markdown: {
            smartypants: true
        }
    });
</script>

<aside class="miage_aside_logo"></aside>

</body>
</html>
